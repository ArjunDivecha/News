# Step 4: Report Generation

Generate daily market wrap and flash reports using LLMs, powered by your curated 970-asset universe and 3-tier taxonomy.

## Quick Start

```bash
cd "Step 4 Report Generation/scripts"

# One-time setup
python setup_database.py

# Daily report generation (SINGLE COMMAND - loads data + generates PDF)
python generate_report.py --date 2026-02-03 --models anthropic --structured

# Optional: Skip data loading if already loaded
python generate_report.py --date 2026-02-03 --models anthropic --structured --skip-load-data
```

## Overview

This pipeline transforms Bloomberg market data into professional investment committee reports:

1. **Data Layer:** 970 curated assets with 3-tier taxonomy and 18 beta exposures
2. **Historical Layer:** SQLite database accumulating daily snapshots
3. **Analysis Layer:** Pattern detection, streak tracking, percentile ranks
4. **Report Layer:** Multi-model LLM generation (GPT, Claude, Gemini)
5. **Output Layer:** Professional PDF reports

## Report Generation

### Single Command Workflow (RECOMMENDED)

The `generate_report.py` script automatically:
1. Loads Bloomberg data from Excel into SQLite
2. Prepares data summaries and category statistics
3. Generates structured JSON report via LLM
4. Converts to professional PDF with PrinceXML

```bash
# Complete workflow in one command
python scripts/generate_report.py --date 2026-02-03 --models anthropic --structured

# Output: outputs/comparison/2026-02-03/anthropic_report.pdf
```

**Features:**
- Automatic data loading (use `--skip-load-data` to disable)
- Structured JSON output with sections, tables, and narratives
- Professional PDF/X-1a:2003 quality via PrinceXML
- Executive synthesis, flash headlines, and detailed sections
- ~2-3 minutes total runtime

## Report Types

### Daily Wrap (After Close)
- Comprehensive market analysis
- 1,000-1,500 words
- 7 tables covering all taxonomy levels
- Historical pattern context
- Generated by 3 LLMs in parallel
- **Output:** Professional PDF via PrinceXML

### Flash Report (Every 15 Minutes)
- Quick intraday snapshot
- 200-300 words
- 2 tables max
- Focus on unusual moves
- Generated by fast LLM

## Taxonomy Structure

**Tier-1 (7 Asset Classes):**
- Equities (520)
- Fixed Income (170)
- Commodities (110)
- Multi-Asset/Thematic (80)
- Volatility/Risk Premia (50)
- Alternative/Synthetic (20)
- Currencies (20)

**Tier-2 (20+ Strategies):**
- Thematic/Factor, Global Indices, Sector Indices, etc.

**Tier-3 (60+ Tags):**
- Region: US, Europe, Asia, EM, Global
- Sector: Tech, Energy, Financials, Healthcare
- Style: Value, Growth, Momentum, Quality
- Strategy: Long/Short, Options-Based, Quantitative

## Database

SQLite database at `database/market_data.db`:

| Table | Purpose |
|-------|---------|
| `assets` | 970 assets with taxonomy and betas |
| `daily_prices` | Historical daily snapshots |
| `intraday_prices` | Intraday data (7-day retention) |
| `category_stats` | Pre-computed aggregates |
| `factor_returns` | Factor returns for attribution |
| `reports` | Generated report archive |

## Bloomberg Integration

Bloomberg data is fetched via Parallels (Windows):

1. Run `bloomberg_fetcher.py` on Windows
2. CSV written to shared Dropbox folder
3. Mac reads CSV and loads to SQLite

## Report Philosophy

**What Reports Show:**
- Category/theme performance (Tier-1, Tier-2, Tier-3)
- Historical patterns, streaks, extremes
- Beta attribution analysis
- Unusual pattern flags

**What Reports DON'T Show:**
- Individual security names
- Data source attribution
- Raw price data

**Core Motif:** Identify UNUSUAL patterns—anomalies, outliers, regime shifts.

## Files

```
Step 4 Report Generation/
├── database/
│   ├── schema.sql          # Database schema
│   ├── market_data.db      # SQLite database
│   └── init_db.py          # Initialization
├── prompts/
│   ├── daily_wrap.md              # Markdown report prompt
│   ├── daily_wrap_structured.md   # Structured JSON prompt (for PrinceXML)
│   └── flash_report.md            # Flash report prompt
├── scripts/
│   ├── generate_report.py         # PRIMARY: Single-command report generation
│   ├── setup_database.py          # One-time: Sync Final 1000 list to DB
│   ├── compute_correlations.py   # Optional: Compute asset correlations
│   ├── calculate_ytd.py           # Utility: Calculate YTD returns
│   ├── bloomberg_backfill.py      # Windows: Historical data backfill
│   ├── bloomberg_daily.py         # Windows: Daily data fetch
│   ├── bloomberg_fetcher.py       # Windows: Bloomberg API wrapper
│   └── utils/
│       ├── pdf_prince/            # PrinceXML PDF converter
│       ├── pdf_weasyprint.py      # WeasyPrint fallback
│       ├── db.py                  # Database utilities
│       └── llm.py                 # LLM API wrappers
└── outputs/
    └── comparison/         # Professional PDF reports
```

## Requirements

- **PrinceXML:** Professional PDF generation (install from https://www.princexml.com/)
- **Python 3.11+** with packages: `anthropic`, `pandas`, `openpyxl`, `jinja2`
- **Bloomberg Data:** Excel template with daily market data

## Status

See `PLAN.md` for detailed implementation status and next steps.

---

**Last Updated:** 2026-02-03
